# Sprint 03 – TS Test Alignment & DocUI Execution
- **Date Range:** 2025-11-22 ~ 2025-11-29
- **Theme:** 完成 AA4 Batch #1（DocUI ReplacePattern）交付并启动 TS Test Alignment 下一阶段，确保 Porter→QA→Info-Indexer→DocMaintainer 通过 runSubAgent 循环推进，每次循环结束都在本文件登记进度。
- **RunSubAgent 周期:** 本 Sprint 以“1 次 runSubAgent = 1 个多步循环”计数。每当某位 AI 员工被调用，必须在回报前先更新 `docs/sprints/sprint-03.md` 的 `Progress Log`，标注任务、成果与下一步。管理者（主 Agent）在汇报后同步 `docs/plans/ts-test-alignment.md` 的 Live Checkpoints。

## Objectives
1. **Batch #1 – ReplacePattern**
   - Porter-CS：落地 `ReplacePattern.cs`、`DocUIReplaceController`、`ReplacePatternTests.cs`（测试数据内联，无需 fixtures/snapshots）。
   - QA-Automation：运行 Batch #1 命令（全量 `dotnet test`、`ReplacePatternTests` filter），产出 TRX 与 QA 报告。
   - Info-Indexer：发布 `agent-team/indexes/README.md#delta-2025-11-22`，同步迁移日志。
   - DocMaintainer：引用新 delta 更新 AGENTS / Sprint / Task Board / 计划。
2. **TS Test Alignment – Batch #2 Ready**
   - Investigator-TS：补齐 WordSeparator/SearchContext 规格与 DocUI widget 测试路径调研成果，写入 `docs/plans/ts-test-alignment.md` Appendix。
   - Planner：拆解 Batch #2（FindModel/FindController）runSubAgent 顺序并登记到 Task Board。
   - QA-Automation：草拟 Batch #2 测试矩阵条目与命令草案。
3. **OI Backlog Refresh**
   - Info-Indexer：在 `agent-team/indexes/OI-backlog.md`（若无则创建）登记 OI-012~OI-015（DocUI widget 测试、Snapshot tooling、WordSeparator parity、DocUI harness 设计）。

## Deliverables & Tracking
| ID | Deliverable | Owner | RunSubAgent Step | Evidence / Files | Status |
| --- | --- | --- | --- | --- | --- |
| B1-PORTER | ReplacePattern runtime/controller/tests 实现 | Porter-CS | 1 | `ReplacePattern.cs`, `DocUIReplaceController.cs`, `ReplacePatternTests.cs` | ✅ Done |
| B1-QA | Batch #1 QA 运行 + TRX + snapshots | QA-Automation | 2 | TRX (`batch1-full.trx`, `batch1-replacepattern.trx`), `B1-QA-Result.md` | ✅ Done |
| B1-INFO | Changefeed `#delta-2025-11-22` 发布 | Info-Indexer | 3 | `agent-team/indexes/README.md`, `docs/reports/migration-log.md` | ✅ Done |
| B1-DOC | AGENTS/Sprint/Task Board 更新 | DocMaintainer | 4 | `AGENTS.md`, `docs/sprints/sprint-03.md`, `agent-team/task-board.md`, `docs/plans/ts-test-alignment.md` | ✅ Done |
| B2-INV | WordSeparator spec & DocUI widget 测试定位 | Investigator-TS | 5 | `docs/plans/ts-test-alignment.md` Appendix, notes | Planned |
| B2-PLAN | Batch #2 调度方案 | Planner | 6 | `agent-team/task-board.md`, `docs/plans/ts-test-alignment.md` | Planned |
| B2-QA | Batch #2 测试矩阵扩展 | QA-Automation | 7 | `tests/TextBuffer.Tests/TestMatrix.md`, QA memo | ✅ Done |
| OI-REFRESH | OI backlog 记录 OI-012~015 | Info-Indexer | 8 | `agent-team/indexes/oi-backlog.md` | ✅ Done |
| B3-FM | SelectAllMatches 多光标语义 + FM-01/FM-02 测试 | Porter-CS | 9 | `src/TextBuffer/DocUI/FindModel.cs`, `tests/TextBuffer.Tests/DocUI/DocUIFindModelTests.cs`, `agent-team/handoffs/B3-FM-Result.md` | ✅ Done |
| B3-FC | DocUI FindController core（host/clipboard/storage + commands + tests） | Porter-CS | 10 | `src/TextBuffer/DocUI/DocUIFindController.cs`, `tests/TextBuffer.Tests/DocUI/DocUIFindControllerTests.cs`, `agent-team/handoffs/B3-FC-Result.md` | ✅ Done |
| B3-FC-Scope | FindController searchScope lifecycle + Ctrl/Cmd+F3 whitespace fix | Porter-CS | 11 | `src/TextBuffer/DocUI/DocUIFindController.cs`, `tests/TextBuffer.Tests/DocUI/DocUIFindControllerTests.cs`, `agent-team/handoffs/B3-FC-Review.md` | ✅ Done |
| B3-Decor | FindDecorations stickiness + TextModel decoration APIs + DocUI overlay tests | Porter-CS | 12 | `src/TextBuffer/DocUI/FindDecorations.cs`, `src/TextBuffer/TextModel.cs`, `tests/TextBuffer.Tests/DecorationTests.cs`, `tests/TextBuffer.Tests/DecorationStickinessTests.cs`, `tests/TextBuffer.Tests/DocUI/DocUIFindDecorationsTests.cs`, `agent-team/handoffs/B3-Decor-PORTER.md`, `agent-team/handoffs/B3-Decor-Stickiness-Review.md` | ✅ Done |

## Progress Log
> 规则：每次 runSubAgent 调用结束前，由该员工在下表新增一行，包含序号（Run #）、日期、员工、任务、结果、下一步。

| Run # | Date | Employee | Task | Result | Next Steps |
| --- | --- | --- | --- | --- | --- |
| R0 | 2025-11-22 | Main Agent | Sprint 03 建立 | 创建本文件，定义目标/RunSubAgent 节奏/跟踪规则 | 启动 B1-PORTER |
| R1 | 2025-11-22 | Porter-CS | B1-PORTER ReplacePattern 实现 | 交付 `ReplacePattern.cs`, `DocUIReplaceController.cs`, `ReplacePatternTests.cs` (23 tests)；dotnet test 142/142 通过；详见 `agent-team/handoffs/B1-PORTER-Result.md` | 启动 B1-QA |
| R2 | 2025-11-22 | QA-Automation | B1-QA ReplacePattern 验证 | 全量测试 142/142，专项测试 23/23，100% 通过；已更新 `TestMatrix.md`；TRX 文件已生成；详见 `agent-team/handoffs/B1-QA-Result.md` | 启动 B1-INFO |
| R3 | 2025-11-22 | Info-Indexer | B1-INFO Changefeed 发布 | 发布 `#delta-2025-11-22`，更新迁移日志；交叉引用已验证；详见 `agent-team/handoffs/B1-INFO-Result.md` | 启动 B1-DOC |
| R4 | 2025-11-22 | DocMaintainer | B1-DOC 文档同步 | 更新 AGENTS/Sprint/Task Board/Plan 4 个文档；Changefeed 引用统一为 `#delta-2025-11-22`；一致性检查通过；详见 `agent-team/handoffs/B1-DOC-Result.md` | **Batch #1 完成** |
| R4 | 2025-11-22 | DocMaintainer | B1-DOC 文档同步 | 更新 `AGENTS.md`、`docs/sprints/sprint-03.md`、`agent-team/task-board.md`、`docs/plans/ts-test-alignment.md`；所有 changefeed 引用已统一为 `#delta-2025-11-22`；详见 `agent-team/handoffs/B1-DOC-Result.md` | Batch #1 完成，准备 B2-INV |
| R5 | 2025-11-22 | Investigator-TS | B2-INV WordSeparator 规格调研 | 补全 WordSeparator 规格（Appendix B），确认 FindWidget 测试不存在，列出 Batch #2 依赖清单；详见 `agent-team/handoffs/B2-INV-Result.md` | 启动 B2-PLAN |
| R6 | 2025-11-22 | Planner | B2-PLAN Batch #2 任务拆解 | 拆解为 B2-001~005（FindModel stubs → 核心逻辑 → 测试 → changefeed → 文档）；登记 Task Board；详见 `agent-team/handoffs/B2-PLAN-Result.md` | 并行启动 B2-QA + OI-REFRESH |
| R7 | 2025-11-22 | QA-Automation | B2-QA 测试矩阵草拟 | 选择 15 个核心测试场景（P0/P1/P2 分级），设计 `TestEditorContext` harness，定义 Porter-CS API 契约；详见 `agent-team/handoffs/B2-QA-Result.md` | 等待 B2-001 启动 |
| R8 | 2025-11-22 | Info-Indexer | OI-REFRESH Backlog 创建 | 创建 `oi-backlog.md`，登记 OI-012~015（Widget 测试框架、Snapshot 工具、WordSeparator parity、Harness 标准化）；详见 `agent-team/handoffs/OI-REFRESH-Result.md` | Sprint 03 准备工作完成 |
| R9 | 2025-11-22 | Porter-CS | B2-001 FindModel Stubs 创建 | 创建 `FindReplaceState.cs`、`FindDecorations.cs`（stub）、`FindModel.cs`（空壳）；7 个验证测试，dotnet test 149/149 通过；详见 `agent-team/handoffs/B2-001-Result.md` | 启动 B2-002 |
| R10 | 2025-11-22 | Porter-CS | B2-002 FindModel 核心逻辑 | 完成 `FindDecorations.cs`、`FindModel.cs` 核心功能（搜索/导航/替换）；9 个功能测试，dotnet test 156/156 通过；详见 `agent-team/handoffs/B2-002-Result.md` | 启动 B2-003 |
| R11 | 2025-11-23 | Investigator-TS | B3-INV | Batch #3 规格 & 调度表输出 | 启动 R12 (B3-FM) |
| R12 | 2025-11-23 | Porter-CS | B3-FM SelectAllMatches parity (R12) | 完成 `FindModel.SelectAllMatches` TS 对齐，新增 FM-01/FM-02 测试（搜索范围排序 + 主光标保持），`export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --nologo` 186/186 绿；详见 `agent-team/handoffs/B3-FM-Result.md` | 移交 QA/DocMaintainer 处理剩余 Batch #3 场景（FindController/WordBoundary、多光标可视化） |
| R13 | 2025-11-23 | Porter-CS | B3-FSel getSelectionSearchString (R13) | 新增 `FindUtilities` + `IEditorSelectionContext`，`DocUIFindSelectionTests` 覆盖 TS `find.test.ts` 三场景；`export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --nologo` 189/189 绿；详见 `agent-team/handoffs/B3-FSel-Result.md`（`#delta-2025-11-23-b3-fsel`） | 启动 R14 – B3-FC-Core（Porter-CS，对应 FindController 导航/Regex 逃逸） |
| R14 | 2025-11-23 | Porter-CS | B3-FC-Core FindController 实现 | 交付 `DocUIFindController` + host/stub（storage/clipboard/selection context）并移植 issue #1857/#3090/#6149/#41027/#9043/#27083/#58604/#38232 测试；`export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter DocUIFindControllerTests --nologo` 10/10，`dotnet test ... --nologo` 199/199。详见 `agent-team/handoffs/B3-FC-Result.md`（`#delta-2025-11-23-b3-fc-core`）。 | R15 聚焦 searchScope lifecycle + Mac 全局剪贴板/富文本 seed（B3-FC-Scope），R16 回到 Decorations stickiness。 |
| R15 | 2025-11-23 | Porter-CS | B3-FC-Scope scope lifecycle + Ctrl/Cmd+F3 regression | 修复 `BuildSearchScope()` 空返回时清空范围的问题（仅在非空范围时更新 `_state.SearchScope`）并让 `NextSelectionMatchFindAction()` 在失败后必定 `Start()` + 重试，新增 `SearchScopePersistsWhenSelectionCollapses` 与 `NextSelectionMatchOnWhitespaceRevealsWidget`，`export PIECETREE_DEBUG=0 && dotnet test ... --filter DocUIFindControllerTests --nologo` 15/15。详见 `docs/reports/migration-log.md` / `agent-team/indexes/README.md#delta-2025-11-23-b3-fc-scope`。 | 继续 R15 backlog：Mac 全局剪贴板富文本 seed + searchScope UI 提示；R16 进入 Decorations stickiness / DocUI overlay capture。 |
| R16 | 2025-11-23 | Investigator-TS | B3-Decor Stickiness 调研 & 交班 | 对 `findDecorations.ts`、`modelDecorations.test.ts`、`DocUIFindController`/`FindDecorations.cs` parity 做矩阵，标记 range highlight/overview throttling、`TrackedRangeStickiness`、`GetLineDecorations`/`GetAllDecorations` API、DocUI harness 缺口，于 `agent-team/handoffs/B3-Decor-INV.md` 输出实现/测试计划并把 delta 定位在 `#delta-2025-11-23-b3-decor-stickiness`。 | 交给 Porter-CS 启动 Decorations API+行为移植（range highlight、overview throttling、stickiness matrix）并让 QA 准备 TS parity 测试移植；DocMaintainer 后续跟进 changefeed/plan 更新。 |
| R17 | 2025-11-23 | Porter-CS | B3-Decor Stickiness & Decoration APIs | 完成 `FindDecorations` range highlight trimming、overview throttling、高亮 stickiness 元数据，以及 `TextModel.GetAllDecorations/GetLineDecorations/GetDecorationIdsByOwner`；新增 `DecorationStickinessTests` + `DocUIFindDecorationsTests` + Expanded `DecorationTests`，`dotnet test ... --nologo` 233/233，targeted filters（stickiness/DocUI装饰）全绿；详见 `agent-team/handoffs/B3-Decor-PORTER.md` / `#delta-2025-11-23-b3-decor-stickiness`。 | Info-Indexer 公布新 delta，DocMaintainer/QA 更新 TestMatrix、Sprint、Task Board 引用；后续 R18 关注剩余 B3 backlog（Diff fuzz、DocUI snapshot）。 |
| R18 | 2025-11-23 | Porter-CS | B3-Decor-Stickiness Review (CI-1/CI-2/CI-3 + W-1/W-2) | 去除 `_cachedFindScopes`、保持 scope 原始换行、将 overview merge 逻辑接入 `ViewportHeightPx` provider，并为 `FindDecorations` 动态分配 owner；`DocUIFindDecorationsTests` 新增 scope newline/track edits/viewport throttling 三个用例，`dotnet test ... --nologo` 235/235，全量+`--filter DocUIFindDecorationsTests` 9/9 绿；详见 `agent-team/handoffs/B3-Decor-Stickiness-Review.md` / `#delta-2025-11-23-b3-decor-stickiness-review`。 | DocMaintainer/Info-Indexer 更新 TestMatrix、计划、Task Board、迁移日志、changefeed；下一步监控 Diff fuzz / DocUI snapshot backlog。 |
| R19 | 2025-11-24 | Porter-CS | B3 DocUI Staged Fixes (FindDecorations reset + caret overlap) | `FindDecorations.Reset()` 保留 `_startPosition`，`IntervalTree.CollectOverlaps()` 捕获零宽查询；`DocUIFindModelTests` 新增 **Test48_FlushEditKeepsFindNextProgress**，`DocUIFindDecorationsTests` 增补 **CollapsedCaretAtMatchStartReturnsIndex**。QA rerun：`export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter FullyQualifiedName~FindModelTests --nologo` 46/46、`--filter FullyQualifiedName~DocUIFindDecorationsTests --nologo` 9/9。详见 `agent-team/handoffs/B3-DocUI-StagedFixes-20251124.md` / `agent-team/handoffs/B3-DocUI-StagedFixes-QA-20251124.md` / `docs/reports/migration-log.md`（B3-DocUI-StagedFixes 行） / [`agent-team/indexes/README.md#delta-2025-11-24-b3-docui-staged`](agent-team/indexes/README.md#delta-2025-11-24-b3-docui-staged)。 | 跟踪 B3-FM multi-selection（B3-FM-MSel-*）并记录 `FullyQualifiedName~FindModelTests` 为 DocUI rerun 的唯一合法过滤器，防止旧 alias 0/0。 |
| R20 | 2025-11-24 | Investigator-TS | B3-FM-MSel-INV multi-selection audit | 发布 `agent-team/handoffs/B3-FM-MultiSelection-Audit.md`：记录 TS Test07/08 scope 表、突出 F1–F3（TestEditorContext 无多选桥接、FindModel 仅保存单选、DocUIFindModelTests 缺覆盖），并在 `docs/plans/ts-test-alignment.md` / 计划文档添加 `#delta-2025-11-24-b3-fm-multisel` 占位。 | Porter-CS 依据审计实现多选 harness + FindModel API + Test07/08，再交给 QA 运行 `--filter FullyQualifiedName~FindModelTests.Test0(7|8)` 并发布对应 changefeed。 |
| R21 | 2025-11-24 | Porter-CS | B3-FM-MultiSelection implementation (R21) | `FindModel` 现克隆多选范围并保留主光标，`TestEditorContext.SetSelections`/`GetSelections` 支持 TS 式 scope staging，`DocUIFindModelTests.Test07/08` 重新启用验证重叠/离散 scope wrap。按要求运行 `export PIECETREE_DEBUG=0 && dotnet test ... --filter "FullyQualifiedName=PieceTree.TextBuffer.Tests.DocUI.FindModelTests.Test07_MultiSelectionFindModelNextStaysInScopeOverlap|FullyQualifiedName=PieceTree.TextBuffer.Tests.DocUI.FindModelTests.Test08_MultiSelectionFindModelNextStaysInScope" --nologo` 与 `--filter "FullyQualifiedName~FindModelTests" --nologo`（48/48），全量 `dotnet test ... --nologo` 242/242 绿；详见 `agent-team/handoffs/B3-FM-MultiSelection-PORT.md` + `docs/reports/migration-log.md` 新行。 | 1) QA 复查多选矩阵并确认所有 rerun 模板切换至 `FindModelTests`; 2) Info-Indexer 发布 `#delta-2025-11-24-b3-fm-multisel` 并提示 DocMaintainer 更新 AGENTS/Task Board/TS plan；3) 广播 alias 已退役。 |
| R22 | 2025-11-24 | QA-Automation | B3-FM multi-selection QA validation | Ran `export PIECETREE_DEBUG=0 && dotnet test ... --filter "FullyQualifiedName=PieceTree.TextBuffer.Tests.DocUI.FindModelTests.Test07_MultiSelectionFindModelNextStaysInScopeOverlap|FullyQualifiedName=PieceTree.TextBuffer.Tests.DocUI.FindModelTests.Test08_MultiSelectionFindModelNextStaysInScope" --nologo` (2/2, 1.7s), `--filter "FullyQualifiedName~FindModelTests" --nologo` (48/48, 3.3s), and full `--nologo` sweep (242/242, 2.9s); documented in `tests/TextBuffer.Tests/TestMatrix.md` and `agent-team/handoffs/B3-FM-MultiSelection-QA.md` for `#delta-2025-11-24-b3-fm-multisel`. | Await Info-Indexer changefeed publish + DocMaintainer doc sync; monitor filter alias cleanup follow-up. |
| R23 | 2025-11-24 | Investigator-TS | B3-PieceTree-Fuzz-INV catalog | Studied `ts/src/vs/editor/test/common/model/pieceTreeTextBuffer/pieceTreeTextBuffer.test.ts` + plan Appendix to itemize remaining fuzz/invariant suites, compared vs `tests/TextBuffer.Tests/*` coverage, and documented required harness/invariant work plus runSubAgent sequencing in `agent-team/handoffs/B3-PieceTree-Fuzz-INV.md`（引用 `#delta-2025-11-23-b3-piecetree-fuzz` 作为 Investigator anchor）。 | Pending Planner/Porter scheduling for R24 harness build, then QA to add TestMatrix rows + changefeed publish. |
| R24 | 2025-11-24 | Planner | B3-PieceTree-Fuzz execution plan | Assessed R25→R29 scope vs Sprint 03 window, locked plan in `agent-team/handoffs/B3-PieceTree-Fuzz-PLAN.md`, updated Task Board/TS plan to预设 `#delta-2025-11-23-b3-piecetree-fuzz` / `#delta-2025-11-24-b3-piecetree-fuzz` 两个 delta 并保留 soak/perf carryover。 | Trigger Porter-CS R25 harness run and require each follow-up run to log progress against the two fuzz changefeeds. |
| R25 | 2025-11-24 | Porter-CS | B3-Fuzz-Harness & Tree Invariants | Added env-seeded `PieceTreeFuzzHarness` + range diff helper, extended `FuzzLogCollector`, hardened `PieceTreeModel.AssertPieceIntegrity()` with TS `assertTreeInvariants` parity, updated TestMatrix/migration log, and logged `dotnet test --filter PieceTreeFuzzHarnessTests` + `export PIECETREE_DEBUG=0 && dotnet test ... --nologo` (245/245)，等待 Info-Indexer 发布 `#delta-2025-11-23-b3-piecetree-fuzz`。 | R26 can now port deterministic TS suites using the harness; flag QA/Planner when ready for changefeed publication并在 R27 承接 deterministic 套件。 |
| R26 | 2025-11-24 | Info-Indexer | B3 Fuzz/TestFailures changefeed发布 | 在 `agent-team/indexes/README.md` 新增 `#delta-2025-11-23-b3-piecetree-fuzz`、`#delta-2025-11-24-b3-piecetree-fuzz`、`#delta-2025-11-24-b3-sentinel`、`#delta-2025-11-24-b3-getlinecontent`，同步 `docs/reports/migration-log.md` 对应行，列出代码/测试路径与 targeted commands。 | DocMaintainer 更新 AGENTS / Sprint / 计划 / 成员记忆并广播新锚点；QA 参考新 anchors rerun 记录。 |
| R27 | 2025-11-24 | DocMaintainer | B3 Fuzz + TestFailures 文档同步 | 将 AGENTS、Sprint 03、`docs/plans/ts-test-alignment.md`、`agent-team/members/planner.md` 文本切换为引用上述四个 changefeed，并在 Progress Log 登记本次同步；记录 `dotnet test --filter PieceTreeFuzzHarnessTests`、`--filter PieceTreeBaseTests...`、`-v m` 等命令。 | 通知 Task Board/Planner 继续跟踪 R28（Snippet fuzz soak）与后续 QA；保持 changefeed / 迁移日志引用一致。 |
| R28 | 2025-11-25 | Porter-CS | B3-PieceTree-Snapshot parity (`#delta-2025-11-25-b3-piecetree-snapshot`) | Streamed `PieceTreeSnapshot.Read()` to match TS sequencing (BOM first, single-pass slices), exposed `TextModel.CreateSnapshot()`, added `SnapshotReader` helper, refreshed legacy smoke tests, and ported TS `bug #45564` + `immutable snapshot 1/2/3` into `PieceTreeSnapshotParityTests`. Documented rerun guidance in TestMatrix + migration log and published `agent-team/handoffs/B3-PieceTree-Snapshot-PORT.md`. Commands logged: `export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter PieceTreeSnapshotParityTests --nologo` (4/4) and `export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --nologo` (312/312). | DocMaintainer to sync AGENTS/task-board references to the new delta; Info-Indexer/QA to monitor future snapshot tooling (OI-013) now that `SnapshotReader` + `TextModel.CreateSnapshot()` exist. |
| R29 | 2025-11-25 | QA-Automation | B3-PieceTree-Snapshot QA validation | Replayed Porter’s commands with `PIECETREE_DEBUG=0`: `dotnet test --filter PieceTreeSnapshotParityTests --nologo` (4/4, 1.7s) and full `dotnet test --nologo` (312/312, 53.6s). Logged outcomes in `tests/TextBuffer.Tests/TestMatrix.md` (Run R29) and `agent-team/handoffs/B3-PieceTree-Snapshot-QA.md`, confirming parity with TS scripts and establishing QA evidence for `#delta-2025-11-25-b3-piecetree-snapshot`. | Track OI-013 snapshot tooling follow-up once DocMaintainer/Info-Indexer broadcast completes. |
| R30 | 2025-11-25 | Planner | B3 search-offset cache planning + board refresh | Reviewed backlog, migration log, TS test plan, and Sprint trackers; published `agent-team/handoffs/B3-PieceTree-SearchOffset-PLAN.md`, updated `agent-team/task-board.md` with snapshot closure, fuzz statuses, and new search-offset rows, and prepped Sprint/TestMatrix touch points for changefeed `#delta-2025-11-25-b3-search-offset`. | Call Investigator-TS next (R31) to capture TS scripts per the plan, then line up Porter-CS for `PieceTreeSearchOffsetCacheTests` once the audit memo lands. |
| R31 | 2025-11-25 | Investigator-TS | B3-PieceTree-SearchOffset-INV | Captured the render-whitespace + three remaining normalized-EOL TS scripts, mapped them to `PieceTreeSearchOffsetCacheTests`, and documented helper expectations + changefeed references in `agent-team/handoffs/B3-PieceTree-SearchOffset-INV.md`. | Await Porter-CS run (`B3-SearchOffset-PORT`) to add deterministic scripts/tests, then hand off to QA/Info-Indexer for `#delta-2025-11-25-b3-search-offset`. |
| R32 | 2025-11-25 | Porter-CS | B3-SearchOffset-PORT deterministic cache parity | Added four deterministic scripts plus regression coverage, created `PieceTreeSearchOffsetCacheTests` (5 Facts) with cache inspection helpers, updated TestMatrix/plan/migration log/task board/Sprint for `#delta-2025-11-25-b3-search-offset`, and logged `export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter PieceTreeSearchOffsetCacheTests --nologo` (5/5) + full sweep 312/312 in `agent-team/handoffs/B3-PieceTree-SearchOffset-PORT.md`. | QA-Automation to rerun targeted + full suites, Info-Indexer to publish changefeed, DocMaintainer to broadcast references after QA. |
| R33 | 2025-11-25 | QA-Automation | B3-SearchOffset-QA rerun + handoff | Executed `export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter PieceTreeSearchOffsetCacheTests --nologo` (5/5, 4.3s) and full `--nologo` sweep (324/324, 58.2s); updated `tests/TextBuffer.Tests/TestMatrix.md`, `docs/reports/migration-log.md#b3-searchoffset`, and `agent-team/handoffs/B3-PieceTree-SearchOffset-QA.md`, enabling changefeed [`#delta-2025-11-25-b3-search-offset`](../agent-team/indexes/README.md#delta-2025-11-25-b3-search-offset). | Handed off stats to Info-Indexer + DocMaintainer for immediate broadcast. |
| R34 | 2025-11-25 | DocMaintainer | Search-offset DocMaint sweep | Synced `AGENTS.md`, `agent-team/task-board.md`, `docs/plans/ts-test-alignment.md`, and this Sprint log/TestMatrix with `#delta-2025-11-25-b3-search-offset`, embedding QA commands + changefeed reminder; memory file `agent-team/members/doc-maintainer.md` updated accordingly. | Monitor remaining Snapshot/TextModel references and prep next sweep once Planner opens follow-up deltas. |
| R35 | 2025-11-25 | Investigator-TS | B3-TextModelSearch investigation | `agent-team/handoffs/Review-20251125-Investigator.md` 比对 TS `textModelSearch.test.ts` 与 C# suites，指出 `SearchPatternUtilities.IsMultilineRegexSource` 遗失、TS 45-case battery 尚未移植且 docs/changefeed/TestMatrix 仍标记为“gap”。列出需要更新的文档（ts-test plan、migration log、Sprint、Index）与 backlog（Intl.Segmenter、WordSeparator cache），为 Porter/QA 交付准备验收清单。 | 移交 Porter-CS 在 R36 恢复 helper + 全量测试并记录 rerun；DocMaintainer/Info-Indexer 待代码落地后同步 `#delta-2025-11-25-b3-textmodelsearch` 触点。 |
| R36 | 2025-11-25 | Porter-CS | B3-TextModelSearch helper + 45-test import | 根据 Investigator 结论恢复 `SearchPatternUtilities.IsMultilineRegexSource`，把 TS 45-case TextModelSearch battery（word-boundary、multiline/CRLF、capture arrays、`parseSearchRequest`/`isMultiline`、zero-width/unicode anchors）移植到 `TextModelSearchTests.cs`，并在 `agent-team/handoffs/B3-TextModelSearch-PORT.md` 记录代码/QA 细节。关键验证：`export PIECETREE_DEBUG=0 && dotnet test tests/TextBuffer.Tests/TextBuffer.Tests.csproj --filter FullyQualifiedName~TextModelSearchTests --nologo` → 45/45 green（2.0s），另对 Issue #53415 fixture 做单测回归；Sprint/TestMatrix/migration log 均更新为 `#delta-2025-11-25-b3-textmodelsearch`。 | 等待 Info-Indexer 发布 changefeed、DocMaintainer 校准文档；未决 backlog（Intl.Segmenter word segmentation + WordSeparator cache perf）推入 AA4 pipeline。 |
