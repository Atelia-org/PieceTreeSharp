# Migration Log & Changefeed Checklist

Purpose: capture every PieceTree porting milestone plus its Info-Indexer changefeed delta at `agent-team/indexes/README.md#delta-2025-11-19`, giving AGENTS / Sprints / Task Board editors one audit trail before they update status text.

## How to Append Entries
1. Log the date and Task/Subtask ID exactly as shown on the Task Board.
2. Summarize the delta and cite the concrete files or sections touched using Markdown links (relative paths only).
3. Record the validation evidence (e.g., `dotnet test` command, review notes) and link to the log or README section proving the run.
4. Mark **Changefeed Entry?** = Y only after the update is registered under `agent-team/indexes/README.md#delta-2025-11-19`, and point to that delta inside the Notes column.
5. Future edits to AGENTS / Sprints / Task Board must reference both the relevant row in this table and the matching changefeed entry before saving.

| Date | Task ID | Summary | Key Files | Tests/Validation | Changefeed Entry? (Y/N) | Notes |
| --- | --- | --- | --- | --- | --- | --- |
| 2025-11-19 | PT-003 | Expanded TS↔C# mappings for Piece/PieceTree/SearchContext/BufferRange. | [`agent-team/type-mapping.md`](../../agent-team/type-mapping.md)<br>[`ts/src/vs/editor/common/model/pieceTreeTextBuffer`](../../ts/src/vs/editor/common/model/pieceTreeTextBuffer) | Planner + Info-Indexer review noted in [`agent-team/type-mapping.md`](../../agent-team/type-mapping.md). | Y | Delta recorded at [`agent-team/indexes/README.md#delta-2025-11-19`](../../agent-team/indexes/README.md#delta-2025-11-19); Sprint 00 log cites this row. |
| 2025-11-19 | PT-004.G1 | Wired `PieceTreeBuilder` → `PieceTreeModel` → `PieceTreeBuffer` skeleton with RB helpers. | [`src/PieceTree.TextBuffer/Core`](../../src/PieceTree.TextBuffer/Core)<br>[`src/PieceTree.TextBuffer/README.md#porting-log`](../../src/PieceTree.TextBuffer/README.md#porting-log) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` logged in [`src/PieceTree.TextBuffer/README.md#porting-log`](../../src/PieceTree.TextBuffer/README.md#porting-log). | Y | Changefeed proof at [`agent-team/indexes/README.md#delta-2025-11-19`](../../agent-team/indexes/README.md#delta-2025-11-19); Porting Log cross-references. |
| 2025-11-19 | PT-005.G1 | Established QA matrix + 7 Fact baseline across plain/CRLF/multi-chunk cases. | [`src/PieceTree.TextBuffer.Tests/TestMatrix.md`](../../src/PieceTree.TextBuffer.Tests/TestMatrix.md)<br>[`src/PieceTree.TextBuffer.Tests/UnitTest1.cs`](../../src/PieceTree.TextBuffer.Tests/UnitTest1.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` results archived in [`src/PieceTree.TextBuffer.Tests/TestMatrix.md`](../../src/PieceTree.TextBuffer.Tests/TestMatrix.md). | Y | QA delta logged under [`agent-team/indexes/README.md#delta-2025-11-19`](../../agent-team/indexes/README.md#delta-2025-11-19) and referenced by the matrix. |
| 2025-11-19 | PT-004.LineInfra | Added `LineStartTable`/`LineStartBuilder`, threaded metadata through `ChunkBuffer`, and introduced `PieceTreeSearchCache` + cache hooks in `PieceTreeModel`. | [`src/PieceTree.TextBuffer/Core/LineStarts.cs`](../../src/PieceTree.TextBuffer/Core/LineStarts.cs)<br>[`src/PieceTree.TextBuffer/Core/ChunkBuffer.cs`](../../src/PieceTree.TextBuffer/Core/ChunkBuffer.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeSearchCache.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeSearchCache.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (7/7) | N | Awaiting Info-Indexer changefeed entry for the new shims; reference this row plus future delta when updating PT-004 artifacts. |
| 2025-11-19 | PT-004.Positions | Added `TextPosition`, `PieceTreeBuffer.GetPositionAt/GetOffsetAt/GetLineLength/GetLineCharCode/GetCharCode`, and ported TS-inspired offset/position tests. | [`src/PieceTree.TextBuffer/TextPosition.cs`](../../src/PieceTree.TextBuffer/TextPosition.cs)<br>[`src/PieceTree.TextBuffer/Class1.cs`](../../src/PieceTree.TextBuffer/Class1.cs)<br>[`src/PieceTree.TextBuffer.Tests/UnitTest1.cs`](../../src/PieceTree.TextBuffer.Tests/UnitTest1.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (10/10) | N | Needs Info-Indexer delta for the new prompt + TextPosition additions before task board updates; cite this row when editing PT-004 status. |
| 2025-11-19 | PT-004.Edit | Implemented `PieceTreeModel.Insert/Delete/NodeAt` and `RbDelete` logic; updated `PieceTreeBuffer` to use incremental edits. | [`src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs)<br>[`src/PieceTree.TextBuffer/Class1.cs`](../../src/PieceTree.TextBuffer/Class1.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (13/13) | N | Awaiting Info-Indexer delta; ported TS tests in `PieceTreeBaseTests.cs`. |
| 2025-11-19 | PT-005.Search | Implemented `PieceTreeSearcher`, `PieceTreeModel.Search.cs` (FindMatches), and `SearchTypes`. Ported basic search tests. | [`src/PieceTree.TextBuffer/Core/PieceTreeSearcher.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeSearcher.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.Search.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.Search.cs)<br>[`src/PieceTree.TextBuffer/Core/SearchTypes.cs`](../../src/PieceTree.TextBuffer/Core/SearchTypes.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (16/16) | N | Added `PieceTreeSearchTests.cs`. |
| 2025-11-19 | PT-008.Snapshot | Implemented `PieceTreeSnapshot` and `ITextSnapshot`. Added `CreateSnapshot` to `PieceTreeModel`. | [`src/PieceTree.TextBuffer/Core/PieceTreeSnapshot.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeSnapshot.cs)<br>[`src/PieceTree.TextBuffer/Core/ITextSnapshot.cs`](../../src/PieceTree.TextBuffer/Core/ITextSnapshot.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (18/18) | N | Added `PieceTreeSnapshotTests.cs`. |
| 2025-11-19 | PT-009.LineOpt | Implemented `_lastVisitedLine` caching in `PieceTreeModel` to optimize sequential line access. | [`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (20/20) | N | Added cache invalidation tests in `PieceTreeBaseTests.cs`. |
| 2025-11-19 | PT-010 | Implemented `PieceTreeNormalizer`, `PieceTreeBuilder` upgrades (BOM/Split CRLF), and `_eolNormalized` logic. | [`src/PieceTree.TextBuffer/Core/PieceTreeNormalizer.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeNormalizer.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeBuilder.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeBuilder.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (23/23) | Y | Added `PieceTreeNormalizationTests.cs`. |
| 2025-11-19 | PT-011 | Consolidated PT-004/PT-005. Verified RBTree, Search, Snapshot, Normalization features and 23 passing tests. Updated TestMatrix. | [`src/PieceTree.TextBuffer.Tests/TestMatrix.md`](../../src/PieceTree.TextBuffer.Tests/TestMatrix.md) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (23/23) | Y | PT-004 and PT-005 marked as Done. |
| 2025-11-19 | TM-001 | Analyzed TextModel/Selection/Cursor TS sources. Updated Type Mapping and created Brief. | [`agent-team/type-mapping.md`](../../agent-team/type-mapping.md)<br>[`agent-team/handoffs/TM-001-Brief.md`](../../agent-team/handoffs/TM-001-Brief.md) | N/A | Y | Phase 2 Kickoff. |
| 2025-11-19 | TM-002/3/4 | Implemented `TextModel`, `Selection`, `Position` (IComparable), and `OnDidChangeContent` events. | [`src/PieceTree.TextBuffer/TextModel.cs`](../../src/PieceTree.TextBuffer/TextModel.cs)<br>[`src/PieceTree.TextBuffer/Core/Selection.cs`](../../src/PieceTree.TextBuffer/Core/Selection.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (27/27) | Y | Added `TextModelTests.cs`. |
| 2025-11-19 | TM-005 | Implemented `Cursor` class with basic navigation (Left/Right/Up/Down) and Selection support. | [`src/PieceTree.TextBuffer/Cursor/Cursor.cs`](../../src/PieceTree.TextBuffer/Cursor/Cursor.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (33/33) | Y | Added `CursorTests.cs`. |
| 2025-11-19 | DF-001 | Analyzed Diff/Decoration TS sources. Updated Type Mapping and created Brief. | [`agent-team/type-mapping.md`](../../agent-team/type-mapping.md)<br>[`agent-team/handoffs/DF-001-Brief.md`](../../agent-team/handoffs/DF-001-Brief.md) | N/A | Y | Phase 3 Kickoff. |
| 2025-11-19 | DF-002 | Implemented `DiffComputer` (Myers Algorithm) and `DiffChange`. | [`src/PieceTree.TextBuffer/Diff/DiffComputer.cs`](../../src/PieceTree.TextBuffer/Diff/DiffComputer.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (39/39) | Y | Added `DiffTests.cs`. |
| 2025-11-19 | DF-003/4 | Implemented `IntervalTree` (List-based v1) for Decorations and integrated into `TextModel`. | [`src/PieceTree.TextBuffer/Decorations/IntervalTree.cs`](../../src/PieceTree.TextBuffer/Decorations/IntervalTree.cs)<br>[`src/PieceTree.TextBuffer/TextModel.cs`](../../src/PieceTree.TextBuffer/TextModel.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (47/47) | Y | Added `DecorationTests.cs`. |
| 2025-11-19 | DF-005 | Prototyped `MarkdownRenderer` for DocUI visualization (Cursors/Selections). | [`src/PieceTree.TextBuffer/Rendering/MarkdownRenderer.cs`](../../src/PieceTree.TextBuffer/Rendering/MarkdownRenderer.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (50/50) | Y | Added `MarkdownRendererTests.cs`. |
| 2025-11-19 | AA-001~004 | Audited Core, Model, Search, and Diff/Decorations against TS originals. Identified gaps (Split CRLF, Cache, Word Search, Sticky Cursor). | [`agent-team/handoffs/AA-001-Audit.md`](../../agent-team/handoffs/AA-001-Audit.md)<br>[`agent-team/handoffs/AA-002-Audit.md`](../../agent-team/handoffs/AA-002-Audit.md) | N/A | Y | Phase 4 Kickoff. |
| 2025-11-19 | AA-005 | Fixed Core gaps: Split CRLF handling (Critical) and Search Cache integration. | [`src/PieceTree.TextBuffer/Core/PieceTreeModel.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (53/53) | Y | Added `AA005Tests.cs`. |
| 2025-11-19 | AA-006 | Fixed Feature gaps: Word Search (Classifier) and Sticky Cursor (Column Memory). | [`src/PieceTree.TextBuffer/Core/PieceTreeSearcher.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeSearcher.cs)<br>[`src/PieceTree.TextBuffer/Cursor/Cursor.cs`](../../src/PieceTree.TextBuffer/Cursor/Cursor.cs) | `dotnet test PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (56/56) | Y | Added `AA006Tests.cs`. |
| 2025-11-20 | AA2-005 | Restored split CRLF repair, metadata recomputation, search cache invalidation, and piece count tracking with new regression coverage. | [`src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeModel.Edit.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeNode.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeNode.cs)<br>[`src/PieceTree.TextBuffer/Core/PieceTreeSearchCache.cs`](../../src/PieceTree.TextBuffer/Core/PieceTreeSearchCache.cs)<br>[`src/PieceTree.TextBuffer.Tests/UnitTest1.cs`](../../src/PieceTree.TextBuffer.Tests/UnitTest1.cs) | `dotnet test src/PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (60/60) | Y | Logged under [`agent-team/indexes/README.md#delta-2025-11-20`](../../agent-team/indexes/README.md#delta-2025-11-20). |
| 2025-11-20 | AA2-005 (Undo/Redo) | Ported the TS undo/redo stack, model option plumbing, and `pushEOL/SetEOL` hooks so C# `TextModel` now mirrors TypeScript semantics. Added resolved options storage, `OnDidChangeOptions/OnDidChangeLanguage` events, and regression tests covering undo slices, stack boundaries, indentation detection, and EOL toggles. | [`src/PieceTree.TextBuffer/TextModel.cs`](../../src/PieceTree.TextBuffer/TextModel.cs)<br>[`src/PieceTree.TextBuffer/EditStack.cs`](../../src/PieceTree.TextBuffer/EditStack.cs)<br>[`src/PieceTree.TextBuffer/TextModelOptions.cs`](../../src/PieceTree.TextBuffer/TextModelOptions.cs)<br>[`src/PieceTree.TextBuffer.Tests/TextModelTests.cs`](../../src/PieceTree.TextBuffer.Tests/TextModelTests.cs) | `dotnet test src/PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj` (66/66) | Y | Changefeed entry at [`agent-team/indexes/README.md#delta-2025-11-20`](../../agent-team/indexes/README.md#delta-2025-11-20); Task Board AA2-005 updated to Done. |
